<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Install details - Predbat Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Install details";
        var mkdocs_page_input_path = "install.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Predbat Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../what-does-predbat-do/">What does Predbat do?</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installing & configuring Predbat</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../installation-summary/">Install summary</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Install details</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#inverter-control-integration-install-givtcpsolax-modbus">Inverter Control Integration install (GivTCP/SolaX-ModBus)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#appdaemon-install">AppDaemon install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hacs-install">HACS install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#predbat-install">Predbat install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#predbat-manual-install">Predbat manual install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#solcast-install">Solcast install</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#octopus-energy">Octopus Energy</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../energy-rates/">Energy rates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../car-charge-planning/">Car charging planning</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../config-yml-settings/">apps.yaml settings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration-guide/">Configuration guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../customisation/">Customisation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../video-guides/">Video Guides</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../faq/">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Viewing Predbat data</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../output-data/">Output data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../creating-charts/">Creating the charts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../predbat-plan-card/">Predbat Plan card</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Predbat development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../other-inverters/">Other Inverters</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../todo-list/">To-do list</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../developing/">Developing on Predbat</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Predbat Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Installing & configuring Predbat</li>
      <li class="breadcrumb-item active">Install details</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="install">Install</h1>
<h2 id="inverter-control-integration-install-givtcpsolax-modbus">Inverter Control Integration install (GivTCP/SolaX-ModBus)</h2>
<p>The Integration that communicates with your inverter will be depend on the brand:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Brand</th>
<th style="text-align: left;">Integration</th>
<th style="text-align: left;">Github Link</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">GivEnergy</td>
<td style="text-align: left;">GivTCP</td>
<td style="text-align: left;"><a href="https://github.com/britkat1980/giv_tcp">https://github.com/britkat1980/giv_tcp</a></td>
</tr>
<tr>
<td style="text-align: left;">Solis</td>
<td style="text-align: left;">SolaX ModBus</td>
<td style="text-align: left;"><a href="https://github.com/wills106/homeassistant-solax-modbus">https://github.com/wills106/homeassistant-solax-modbus</a></td>
</tr>
</tbody>
</table>
<ul>
<li>You will need at least 24 hours history in HA for this to work correctly, the default is 7 days (but you configure this back 1 day if you need to)</li>
</ul>
<h2 id="appdaemon-install">AppDaemon install</h2>
<ul>
<li>Install the AppDaemon add-on <a href="https://github.com/hassio-addons/addon-appdaemon">https://github.com/hassio-addons/addon-appdaemon</a></li>
<li>You will find the appdaemon.yaml file in addon_configs/a0d7b954_appdaemon <img alt="image" src="https://github.com/springfall2008/batpred/assets/48591903/bf8bf9cf-75b1-4a8d-a1c5-fbb7b3b17521" /><ul>
<li>If using the File Editor remember to turn off <strong>enforce base path</strong> to allow access: <img alt="image" src="https://github.com/springfall2008/batpred/assets/48591903/298c7a19-3be9-43d6-9f1b-b46467701ca7" /></li>
</ul>
</li>
<li>Add to the appdaemon: section <strong>apps_dir</strong> which should point to /homeassistant/appdaemon/apps</li>
<li>Set the <strong>time_zone</strong> correctly in appdaemon.yaml (e.g. Europe/London)</li>
<li>Add <strong>thread_duration_warning_threshold: 120</strong> to the appdaemon.yaml file in the appdaemon section</li>
<li>It's recommended you set a new logfile location so that you can see the complete logs, I set mine
to /homeassistant/appdaemon/appdaemon.log and increase the maximum size and number of generations to capture a few days worth</li>
</ul>
<p>Example config:</p>
<pre><code class="language-yaml">appdaemon:
  latitude: 52.379189
  longitude: 4.899431
  elevation: 2
  time_zone: Europe/London
  thread_duration_warning_threshold: 120
  plugins:
    HASS:
      type: hass
  app_dir: /homeassistant/appdaemon/apps
http:
  url: http://homeassistant.local:5050
admin:
api:
hadashboard:
logs:
  main_log:
    filename: /homeassistant/appdaemon/appdaemon.log
    log_generations: 9
    log_size: 10000000
</code></pre>
<p>CAUTION: Migrating from an older Appdaemon to 0.15.2 or above:</p>
<ul>
<li>Make sure you have access to the HA filesystem, e.g. I use the Samba add on and connect to the drives on my Mac, but you can use ssh also.
Update AppDaemon to 0.15.2</li>
<li>Go into addon_configs/a0d7b954_appdaemon and edit appdaemon.yaml. You need to add app_dir (see above) to point to the
old location and update your logfile location (if you have set it). You should remove the line that points to secrets.yaml
(most people don't use this file) or adjust it's path to the new location (/homeassistant/secrets.yaml).</li>
<li>Move the entire 'apps' directory from addon_configs/a0d7b954_appdaemon (new location) to config/appdaemon (the old location)</li>
<li>Restart appdaemon</li>
<li>Check it has started and confirm Predbat is running correctly again.</li>
</ul>
<h2 id="hacs-install">HACS install</h2>
<ul>
<li>Install HACS if you haven't already (<a href="https://hacs.xyz/docs/setup/download">https://hacs.xyz/docs/setup/download</a>)</li>
<li>Enable AppDaemon in HACS: <a href="https://hacs.xyz/docs/categories/appdaemon_apps/">https://hacs.xyz/docs/categories/appdaemon_apps/</a></li>
</ul>
<h2 id="predbat-install">Predbat install</h2>
<p><a href="https://github.com/hacs/integration"><img alt="hacs_badge" src="https://img.shields.io/badge/HACS-Default-41BDF5.svg?style=for-the-badge" /></a></p>
<p>Once installed you will get automatic updates from each release!</p>
<ul>
<li>Add <a href="https://github.com/springfall2008/batpred">https://github.com/springfall2008/batpred</a> as a custom repository of type 'AppDaemon'</li>
<li>Click on the Repo and Download the app</li>
</ul>
<p><em>After an update with HACS you may need to reboot AppDaemon as it sometimes reads the config wrongly during the update
(If this happens you will get a template configuration error in the entity predbat.status).</em></p>
<p>Edit in HomeAssistant config/appdaemon/apps/batpred/config/apps.yaml to configure Predbat - see <a href="../config-yml-settings/#Basics">Configuring apps.yaml</a>.</p>
<p>You must delete the 'template: True' line in the configuration to enable Predbat once you are happy with your configuration.</p>
<p>You may initially want to set <strong>select.predbat_mode</strong> to Monitor to see how Predbat operates, to enable Predbat controls you should then set it to
the correct mode of operation for your system.</p>
<p>Note that future updates to Predbat will not overwrite apps.yaml, but you may need to copy settings for new features across manually</p>
<p>When Predbat starts up initially it will perform a sanity check of the appDaemon configuration itself and confirm the right files are present.
You will see this check in the log, should it fail a warning will be issued and predbat.status will also reflect the warning.
While the above warning might not prevent Predbat from startup you should fix the issue ASAP as it may cause future problems.</p>
<h2 id="predbat-manual-install">Predbat manual install</h2>
<p>Note: <strong>Not recommended if you have HACS</strong></p>
<ul>
<li>Copy apps/predbat/predbat.py to 'config/appdaemon/apps/' directory in home assistant</li>
<li>Copy apps/predbat/apps.yml to 'config/appdaemon/apps' directory in home assistant</li>
<li>
<p>Edit in HomeAssistant config/appdaemon/apps/apps.yml to configure</p>
</li>
<li>
<p>If you later install with HACS then you must move the apps.yml into config/appdaemon/apps/predbat/config</p>
</li>
</ul>
<h2 id="solcast-install">Solcast install</h2>
<p>Predbat needs a solar forecast in order to predict battery levels.</p>
<p>If you don't have solar then comment out the Solar forecast part of the apps.yml:</p>
<pre><code class="language-yaml">  pv_forecast_today: re:(sensor.(solcast_|)(pv_forecast_|)forecast_today)
  pv_forecast_tomorrow: re:(sensor.(solcast_|)(pv_forecast_|)forecast_tomorrow)
  pv_forecast_d3: re:(sensor.(solcast_|)(pv_forecast_|)forecast_(day_3|d3))
  pv_forecast_d4: re:(sensor.(solcast_|)(pv_forecast_|)forecast_(day_4|d4))
</code></pre>
<p>Or make sure Solcast is installed and working (<a href="https://github.com/oziee/ha-solcast-solar">https://github.com/oziee/ha-solcast-solar</a>).</p>
<p>Note that Predbat does not update Solcast for you, it's recommended that you disable polling (due to the API polling limit)
in the Solcast plugin and instead have your own automation that updates the forecast a few times a day (e.g. dawn, dusk and
just before your nightly charge slot).</p>
<p>Example Solcast update script:</p>
<pre><code class="language-yaml">alias: Solcast update
description: &quot;&quot;
trigger:
  - platform: time
    at: &quot;23:00:00&quot;
  - platform: time
    at: &quot;12:00:00&quot;
  - platform: time
    at: &quot;04:00:00&quot;
condition: []
action:
  - service: solcast_solar.update_forecasts
    data: {}
mode: single
</code></pre>
<h2 id="octopus-energy">Octopus Energy</h2>
<p>Follow the instructions at <a href="https://github.com/BottlecapDave/HomeAssistant-OctopusEnergy/">https://github.com/BottlecapDave/HomeAssistant-OctopusEnergy</a>.</p>
<p>Also see the notes in the <a href="../energy-rates/#octopus-energy-plugin">Energy Rates</a> section.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../installation-summary/" class="btn btn-neutral float-left" title="Install summary"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../energy-rates/" class="btn btn-neutral float-right" title="Energy rates">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../installation-summary/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../energy-rates/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
